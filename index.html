<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <style>
      body {
        background: #cbd8f6;
      }

      #date_help {
        color: black;
      }

      .text {
        font-family: 'Raleway', sans-serif;
      }

      .container {
        margin-top: 3vmin;
        padding: 1vmin;
      }

      .invalid-feedback {
        color: #8c2f18;
      }

      footer {
        padding: 5vmin;
      }

      main {
        margin: 1vmin;
        padding: 1vmin;
      }

      .card {
        padding: 4vmin;
        border-radius: 37px;
        background-color: #e5ecfb;
        stroke: black;
      }
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <title>Math Birthdays</title>
  </head>

  <body class="container">
    <header>
      <h1 class="display-1 text text-center">Welcome to Math-Birthdays</h1>
    </header>
    <main class="d-flex align-content-center justify-content-center">
      <section class="card" id="#main-content">
        <div>
          <form id="form">
            <div class="mb-3">
              <label for="input-date" class="form-label text"
                >Your Birthday is on?</label
              >
              <input
                type="date"
                class="form-control"
                id="input-date"
                aria-describedby="date_help"
                required
              />
              <div class="invalid-feedback text">
                The date you enter must be before the current date.
              </div>
              <div id="date_help" class="form-text text mb-2">
                Please enter the day you were born
              </div>
            </div>
            <button type="submit" class="btn btn-success text" id="submit">
              Calculate my next Math-Birthday
            </button>
          </form>
        </div>
      </section>
    </main>
    <hr />
    <footer class="container">
      <h2 class="text text-center">What is a Math Birthday?</h2>
      <p class="text text-center">
        A "math birthday" is a date that is 10^n days after the day they were
        born. On your first math birthday you are 10 days old, and on your
        second you are 100 days old, and on your third you are 1000 days old,
        which is almost 3 years old.
      </p>
    </footer>
    <script>
      const form = document.getElementById('form');
      const main = document.getElementById('#main-content');
      const nowDate = new Date(new Date().setHours(0, 0, 0, 0));

      const createBirthdaySign = (days) => {
        let newDiv = document.getElementById('birthday-div');
        let p = document.getElementById('birtday-text');
        if (!newDiv) {
          newDiv = document.createElement('div');
          newDiv.id = 'birthday-div';
          const hr = document.createElement('hr');
          main.appendChild(hr);
          hr.id = 'hr';
          p = document.createElement('h2');
          p.id = 'birtday-text';
          p.classList.add(['text', 'text-center']);
          newDiv.appendChild(p);
          main.appendChild(newDiv);
        }
        let message = '';
        if (days == 0) {
          message = 'Happy Math Birthday!!';
        } else {
          message = `Your next Math-Birthday is on ${days} from today`;
        }
        p.textContent = message;
      };

      const deleteElementFromArray = (arr, el) => {
        if (arr.contains(el)) arr.remove(el);
      };

      const checkDate = (date) => {
        const inputDate = new Date(date);
        if (inputDate > nowDate) {
          deleteElementFromArray(form[0].classList, 'is-valid');
          form[0].classList.add('is-invalid');
          return false;
        } else {
          deleteElementFromArray(form[0].classList, 'is-invalid');
          form[0].classList.add('is-valid');
          return true;
        }
      };

      const calculateMathBirthday = (date) => {
        let offset = nowDate.getTimezoneOffset() / (60 * 24);
        const date_input = new Date(date);
        let differenceInTime = nowDate - date_input;
        let differenceDays = Math.round(differenceInTime / (1000 * 3600 * 24));
        let x = Math.log10(differenceDays);
        if (Number.isInteger(x)) {
          return 0;
        }
        let y = Math.floor(x) + 1;
        let z = 10 ** y;
        return Math.round(z - 10 ** x);
      };

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        const input = new Date(form[0].value);
        const date = new Date(
          input.getFullYear(),
          input.getMonth(),
          input.getDate() + 1
        );
        const validDate = checkDate(date);
        if (validDate) {
          const days = calculateMathBirthday(date);
          createBirthdaySign(days);
        }
      });
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
